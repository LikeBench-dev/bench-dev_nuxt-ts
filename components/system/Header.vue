<template>
  <header :class="{active : active}" class="header">
    <!--    Burger-->
    <Burger
      :class="{active : active}"
      @clickBurger="active =! active"
    />

    <!--    Main content header-->
    <div :class="{active : active}" class="header-container">
      <!--      Logo-->
      <Logo />

      <!--      Admin menu-->
      <AdminMenu v-if="authUser" @choice="choiceLink" />
      <!--      Client menu-->
      <ClientMenu v-if="!authUser" />

      <!--      Switch-->
      <div class="controls">
        <AppSwitch />
        <AppButton v-if="authUser" btn-class="btn-right btn-danger flex-between exit" @click="logoutUser">
          Выход
          <IconBase width="24" height="24" fill="var(--text-write-primary)" view-box="0 0 24 24">
            <path :d="iconExitRun" />
          </IconBase>
        </AppButton>
      </div>
    </div>

    <!--    City SVG-->
    <IconBase class="iconCity" width="540" height="484" view-box="0 0 540 484">
      <path d="M506.755 0.00986099C507.158 0.00986099 507.959 0.00986099 508.355 -0.000137329C508.368 75.686 508.368 151.372 508.355 227.043C508.204 228.361 508.626 230.195 509.648 230.033C514.261 230.175 518.881 230.003 523.501 229.982C523.526 239.844 523.425 249.705 523.539 259.556C523.451 263.691 525.556 266.468 527.277 269.001C527.27 283.402 527.283 297.793 527.27 312.196C527.289 315.601 526.961 319.219 528.077 322.32C534.316 322.249 540.563 322.31 546.815 322.29C546.871 300.145 546.708 277.981 546.891 255.857C547.092 255.512 547.508 254.844 547.71 254.509C549.922 254.164 552.154 254.468 554.378 254.387C554.422 250.82 554.233 247.232 554.454 243.675C554.662 243.341 555.078 242.682 555.286 242.347C559.2 242.459 563.291 241.313 567.097 243.127C567.399 242.853 567.998 242.286 568.294 242.012C568.187 237.016 568.256 232.018 568.25 227.032C571.307 226.9 574.376 227.265 577.433 226.91C579.229 224.589 577.982 220.12 578.322 216.887C582.627 217.161 587.051 216.33 591.299 217.282C595.843 223.94 599.977 231.339 604.446 238.16C606.451 238.251 608.468 238.19 610.484 237.886C610.459 266.02 610.466 294.153 610.472 322.288H625.996C626.203 321.619 626.62 320.291 626.828 319.623C626.91 297.549 626.815 275.476 626.878 253.403C629.387 253.413 631.907 253.423 634.429 253.383C634.706 250.464 633.584 246.37 635.324 244.373C639.439 244.028 643.567 244.383 647.696 244.231C647.96 247.656 647.052 251.589 648.08 254.7C649.996 256.291 652.454 255.024 654.59 255.389C654.609 267.672 654.546 279.965 654.622 292.249C655.631 291.54 656.589 290.577 657.269 289.138C658.819 285.743 661.051 283.412 662.784 280.28C662.784 267.936 662.778 255.592 662.784 243.258C662.633 232.433 663.093 221.559 662.532 210.776C666.893 210.979 671.274 210.513 675.635 210.989C677.753 212.215 678.673 216.077 680.413 218.235C680.469 230.63 680.388 243.015 680.451 255.41C682.777 258.379 684.718 262.028 686.841 265.352C687.774 266.659 688.032 268.696 688.001 270.612C687.989 287.841 687.995 305.061 687.995 322.289H703.751C703.758 279.723 703.745 237.156 703.758 194.587C710.268 194.587 716.779 194.587 723.29 194.597C723.34 213.042 723.182 231.507 723.365 249.953C723.554 250.267 723.945 250.906 724.14 251.22C726.995 251.575 729.869 251.22 732.744 251.342C732.756 259.916 732.706 268.49 732.769 277.064C732.977 277.692 733.393 278.929 733.607 279.557C735.775 281.27 736.708 285.141 738.744 287.138C739.488 288.81 740.345 290.361 741.234 291.861C743.547 291.891 745.866 291.902 748.185 291.871C749.944 288.993 751.696 286.094 753.542 283.348C753.542 273.355 753.53 263.363 753.548 253.37C759.189 253.36 764.83 253.37 770.478 253.37C770.49 259.988 770.389 266.606 770.534 273.224C772.677 276.366 774.656 279.781 776.724 283.055C778.003 285.153 779.522 287.007 780.291 289.774C780.687 289.835 781.475 289.967 781.873 290.027C781.986 294.557 781.747 299.118 781.98 303.649C782.181 303.973 782.585 304.612 782.786 304.936C790.079 305.25 797.39 304.966 804.688 305.047C804.732 289.662 804.638 274.257 804.701 258.873C804.896 258.539 805.293 257.87 805.495 257.535C811.274 257.231 817.073 257.535 822.871 257.424C822.877 246.276 822.865 235.127 822.871 223.979H847.452C847.452 241.888 847.439 259.786 847.446 277.693C852.066 277.703 856.685 277.703 861.318 277.693C861.318 272.423 861.305 267.153 861.324 261.883C862.679 259.897 864.33 258.285 865.351 255.762C865.761 254.87 866.057 253.401 866.933 253.502C871.465 253.147 876.022 253.492 880.566 253.37C882.432 250.319 884.372 247.38 886.194 244.259C890.927 244.239 895.654 244.249 900.394 244.249C900.394 262.157 900.387 280.055 900.394 297.962H914.26C914.31 282.132 914.159 266.302 914.329 250.492C914.518 250.289 914.909 249.884 915.098 249.681C918.811 249.195 922.548 250.259 926.254 249.428C926.28 245.334 925.901 241.087 926.784 237.135C931.409 237.297 936.043 237.074 940.681 237.216C941.582 237.165 942.118 238.807 941.998 240.125C941.986 259.401 941.979 278.687 941.992 297.963C946.183 297.943 950.374 297.983 954.566 297.983C955.373 298.186 956.577 297.598 956.47 295.926C956.596 287.504 956.349 279.072 956.552 270.671C957.195 266.637 959.463 264.215 960.881 260.942C960.925 240.855 960.881 220.767 960.901 200.681C966.359 200.661 971.823 200.671 977.287 200.671C977.268 218.944 977.325 237.207 977.256 255.47C981.743 256.615 986.338 255.095 990.864 255.987C993.599 257.75 995.288 261.946 997.456 264.976C997.456 280.705 997.45 296.424 997.456 312.154C1000.39 312.164 1003.33 312.164 1006.28 312.154C1006.29 281.749 1006.26 251.356 1006.29 220.961C1013.02 220.961 1019.75 220.89 1026.48 220.971C1027.5 220.738 1027.72 222.765 1027.65 223.981C1027.65 239.184 1027.56 254.386 1027.69 269.588C1031.47 269.608 1035.26 269.578 1039.05 269.598C1039.06 287.161 1039.05 304.726 1039.05 322.289C1049.14 322.33 1059.23 322.208 1069.31 322.35C1070.02 318.377 1069.64 314.202 1069.8 310.138C1070.09 290.212 1069.97 270.267 1069.57 250.353C1069.37 225.076 1069.36 199.79 1069.45 174.515C1072.33 174.272 1075.22 174.353 1078.13 174.343C1078.12 170.957 1078.12 167.582 1078.14 164.197C1081.07 164.227 1084 164.248 1086.95 164.187C1086.94 166.883 1086.94 169.589 1086.95 172.296H1092.63C1092.63 197.633 1092.62 222.969 1092.63 248.307H1107.75C1107.75 241.365 1107.75 234.422 1107.75 227.479C1109.54 224.662 1111.32 221.814 1113.07 218.915C1116.97 218.915 1120.86 218.905 1124.77 218.915C1124.8 246.411 1124.73 273.896 1124.8 301.382C1125.01 302.051 1125.43 303.379 1125.63 304.047C1127.17 303.702 1129.37 305.182 1130.37 302.598C1130.66 298.006 1130.21 293.385 1130.52 288.794C1132.33 284.649 1134.92 281.527 1137.01 277.737C1139.22 277.686 1141.45 277.676 1143.68 277.696C1143.69 254.376 1143.68 231.045 1143.68 207.726C1143.52 205.253 1144.37 203.013 1145.54 201.503C1147.62 198.483 1149.35 194.824 1151.64 192.169C1152.35 190.669 1152.89 188.156 1154.35 188.541C1158.35 188.419 1162.36 188.561 1166.37 188.511C1166.39 232.222 1166.32 275.933 1166.4 319.633C1166.61 320.292 1167.02 321.619 1167.23 322.288H1185.91C1185.91 299.312 1185.9 276.347 1185.91 253.372C1191.79 253.362 1197.67 253.372 1203.55 253.372V600.997H-388.5V322.293H-382.828C-382.796 295.962 -382.872 269.633 -382.796 243.303C-380.918 243.242 -379.046 243.232 -377.168 243.232C-377.156 241.418 -377.143 239.604 -377.124 237.8C-376.916 237.131 -376.5 235.802 -376.292 235.134C-373.008 235.134 -369.731 235.134 -366.447 235.145C-366.429 260.482 -366.447 285.808 -366.441 311.145C-366.429 314.875 -366.681 318.705 -365.937 322.323C-363.258 322.151 -360.567 322.536 -357.888 322.171C-357.68 321.837 -357.271 321.168 -357.062 320.833C-356.879 298.364 -357.044 275.865 -356.986 253.376C-352.575 253.366 -348.163 253.386 -343.751 253.376C-343.744 230.4 -343.757 207.425 -343.751 184.45C-341.74 184.409 -339.729 184.663 -337.725 184.349C-335.91 182.059 -337.164 177.549 -336.824 174.326C-332.015 174.367 -327.206 174.215 -322.403 174.417C-322.359 177.427 -322.353 180.427 -322.365 183.437C-320.884 183.437 -319.397 183.447 -317.91 183.457C-317.916 217.915 -317.884 252.383 -317.928 286.838C-317.928 288.682 -317.758 290.527 -317.563 292.351C-310.119 292.057 -302.669 292.544 -295.226 292.108C-295.138 301.675 -295.346 311.263 -295.144 320.82C-294.942 321.165 -294.526 321.833 -294.318 322.168C-288.954 322.482 -283.572 322.188 -278.202 322.29C-278.108 297.469 -278.373 272.629 -278.07 247.82C-277.068 247.739 -276.059 247.658 -275.051 247.577C-275.013 244.243 -275.183 240.898 -274.975 237.584C-273.608 234.745 -270.929 236.64 -268.987 236.154C-268.716 232.445 -268.729 228.715 -268.792 224.996C-264.418 224.976 -260.05 225.037 -255.683 224.966C-254.397 228.706 -254.989 233.074 -254.888 237.149C-253.628 237.159 -252.367 237.169 -251.107 237.179C-251.094 265.546 -251.107 293.912 -251.1 322.29H-222.738V310.128C-220.526 309.5 -217.507 311.679 -215.881 308.679C-215.755 284.852 -215.749 260.985 -215.887 237.158H-201.675C-198.864 234.836 -196.979 230.59 -194.773 227.103C-190.021 226.931 -185.269 227.052 -180.51 227.032C-180.472 241.525 -180.586 256.028 -180.454 270.531C-176.697 270.673 -172.934 270.582 -169.172 270.592C-169.159 257.762 -169.172 244.931 -169.166 232.09C-165.806 232.08 -162.447 232.1 -159.082 232.09V223.952C-153.649 223.009 -148.128 223.243 -142.682 223.81C-142.638 227.763 -142.846 231.745 -142.619 235.698C-141.037 238.709 -138.019 236.488 -135.838 237.25C-135.724 242.621 -135.781 247.993 -135.769 253.364C-133.456 253.364 -131.142 253.374 -128.829 253.374C-128.823 266.549 -128.836 279.734 -128.829 292.909C-127.033 292.919 -125.224 292.706 -123.435 293.02C-122.186 293.881 -122.527 296.243 -122.546 297.966C-123.151 306.054 -122.262 314.172 -122.527 322.29C-117.788 322.179 -113.035 322.493 -108.296 322.168C-107.079 321.286 -107.451 318.955 -107.375 317.273C-107.514 312.844 -107.066 308.334 -107.804 304.007C-105.365 304.078 -102.919 304.048 -100.467 304.048C-100.467 250.313 -100.449 196.576 -100.48 142.845C-98.3808 142.308 -96.2509 142.379 -94.1457 141.984C-94.114 138.042 -94.3161 134.089 -94.0891 130.167C-93.6793 128.535 -92.5574 128.667 -91.6625 128.677C-83.0468 128.758 -74.4248 128.687 -65.8029 128.728C-65.8029 182.777 -65.8091 236.83 -65.8029 290.87H-44.3735C-44.3735 280.056 -44.3611 269.243 -44.3922 258.439C-44.468 256.716 -44.1528 255.095 -43.7491 253.534C-38.9152 253.858 -34.0743 253.858 -29.2465 253.504C-29.2589 230.812 -29.2341 208.12 -29.2589 185.439C-29.2024 182.865 -29.555 180.108 -28.7484 177.737C-28.7043 177.271 -28.6035 176.328 -28.5593 175.852C-27.1289 172.487 -24.9101 170.338 -23.2969 167.226C-17.0008 167.256 -10.6978 167.165 -4.40115 167.277C-3.74567 168.108 -3.0715 168.919 -2.39676 169.73C-1.30035 172.123 -0.0205078 174.281 1.30911 176.349C3.93726 176.359 6.56534 176.349 9.19348 176.349C9.20593 195.27 9.19348 214.181 9.19971 233.103C10.5045 233.103 11.8154 233.103 13.1326 233.093C13.4417 235.079 13.6618 237.117 13.637 239.185C13.5866 249.654 13.6183 260.123 13.6115 270.602C17.4056 270.582 21.1998 270.622 25.0002 270.622C26.0904 270.693 27.124 270.085 28.1327 269.467C28.0699 202.263 28.139 135.065 28.0948 67.8539C27.8237 64.7729 29.7018 63.0398 30.8112 61.0638C38.1981 49.2876 45.4905 37.3784 52.883 25.6123C53.526 24.3052 54.5975 24.3762 55.5428 24.1932C55.6436 31.7234 56.1038 39.3245 55.4103 46.7936C55.549 47.2596 55.8326 48.1926 55.9713 48.6586C62.4377 48.6386 68.9042 48.6486 75.3769 48.6486C75.3769 92.9273 75.3831 137.196 75.3707 181.471C75.232 182.778 75.7551 184.451 76.6879 184.41C80.0281 184.582 83.3752 184.38 86.7216 184.451C86.7471 169.208 86.6775 153.975 86.7471 138.733C86.6526 135.723 88.3733 134.051 89.5767 132.267C91.0512 129.764 92.545 127.291 93.9194 124.646C101.602 124.676 109.291 124.646 116.974 124.656C116.974 174.317 116.968 223.976 116.974 273.638C121.607 273.658 126.239 273.628 130.878 273.638C130.859 289.357 130.746 305.097 130.916 320.805C131.117 321.15 131.527 321.829 131.736 322.163C138.359 322.467 145.003 322.193 151.639 322.285C151.646 314.177 151.633 306.07 151.646 297.971C154.079 297.951 156.511 297.991 158.95 297.93C159.493 295.964 160.74 294.91 161.339 293.025C161.534 292.964 161.919 292.832 162.115 292.761C162.518 291.474 162.927 289.964 164.025 290.015C167.239 289.589 170.472 289.985 173.699 289.853C173.693 267.243 173.712 244.632 173.693 222.021C173.762 219.406 173.34 216.558 174.242 214.197C174.286 212.859 174.324 211.521 174.374 210.194C175.257 209.566 175.849 208.299 176.58 207.326C177.318 205.826 178.162 204.468 179.107 203.282C180.002 201.356 181.257 199.978 182.164 198.063C182.819 197.11 183.469 196.127 184.13 195.154C184.805 193.857 185.593 192.722 186.412 191.637C194.051 191.566 201.709 191.444 209.341 191.657C209.556 191.991 209.971 192.66 210.18 192.995C210.47 197.079 210.035 201.204 210.331 205.288L211.163 206.626C216.735 206.95 222.319 206.636 227.903 206.748C227.916 244.348 227.884 281.948 227.916 319.55C228.792 319.347 229.85 319.418 230.015 317.635C231.01 316.53 231.868 315.152 232.592 313.601C234.25 311.534 235.649 309.061 237.08 306.618C237.842 305.159 238.674 303.801 239.601 302.594C240.288 300.993 241.719 300.102 241.7 297.892C241.883 289.815 241.706 281.727 241.769 273.65C244.089 273.64 246.414 273.609 248.74 273.68C248.872 272.322 249.005 270.944 249.03 269.565C248.929 259.785 249.704 250.015 249.187 240.256C248.759 233.191 249.212 226.087 248.885 219.023C249.017 218.466 249.282 217.361 249.42 216.804C251.273 216.905 253.138 216.895 255.004 216.885C254.992 213.551 255.004 210.227 255.017 206.902C259.63 206.709 264.244 206.76 268.858 206.851C268.864 210.195 268.87 213.54 268.87 216.884C271.725 216.935 274.587 216.935 277.442 216.884C277.656 217.553 278.078 218.881 278.292 219.549C278.33 222.893 278.33 226.238 278.312 229.592C279.08 230.899 279.805 232.278 280.486 233.717C282.786 236.171 283.965 240.65 286.498 242.555C288.225 248.301 286.026 255.274 287.91 260.949C291.572 267.466 295.675 273.354 299.431 279.728C303.081 280.579 306.774 279.88 310.448 280.052C313.605 279.971 316.77 280.346 319.927 279.88C319.915 273.404 319.921 266.938 319.921 260.462C322.032 260.462 324.143 260.452 326.262 260.462C326.287 257.868 326.053 255.303 325.902 252.729C326.634 250.854 328.265 251.918 329.407 251.645C331.915 252.091 334.606 250.692 336.989 252.425C336.882 261.516 336.957 270.617 336.938 279.717H350.804C350.81 260.127 350.792 240.537 350.81 220.945C352.903 220.935 355.002 220.935 357.107 220.935C357.101 217.216 357.107 213.506 357.113 209.797C361.727 209.777 366.347 209.787 370.973 209.787C370.967 213.506 370.973 217.216 370.973 220.935C372.857 220.935 374.742 220.935 376.633 220.955C376.645 254.187 376.671 287.429 376.62 320.661C379.62 315.877 382.709 311.216 385.602 306.26C387.07 303.341 388.772 300.665 390.884 298.972C392.963 298.374 395.869 300.482 397.369 297.533C397.596 291.635 397.331 285.706 397.489 279.797C399.991 279.746 402.493 279.736 405.002 279.726C405.014 250.336 405.002 220.944 405.008 191.544C406.596 191.128 408.796 192.639 409.981 190.47C410.188 185.068 409.981 179.656 410.031 174.255C410.044 172.877 409.861 171.001 410.907 170.433C411.866 170.159 412.848 170.261 413.838 170.23C413.983 162.953 413.901 155.656 413.933 148.37C414.317 148.025 415.086 147.336 415.477 146.992C418.71 146.941 421.95 146.941 425.19 146.921C426.003 146.688 427.024 147.519 427.042 149.009C427.137 155.749 427.017 162.498 427.068 169.238C428.322 169.248 429.583 169.248 430.85 169.258C430.856 177.032 430.837 184.805 430.856 192.579C432.722 192.589 434.587 192.62 436.465 192.69C436.566 198.73 436.497 204.77 436.522 210.811C438.155 210.821 439.793 210.821 441.444 210.801C442.51 215.686 442.156 220.915 442.194 225.993C442.201 245.767 442.182 265.539 442.201 285.312C449.594 297.372 457.094 309.261 464.525 321.271H472.447C472.453 304.397 472.441 287.522 472.453 270.658C472.485 266.047 472.094 261.294 473.178 256.895C474.029 255.01 475.057 253.348 476.229 251.959C476.235 184.34 476.229 116.717 476.229 49.1056C486.448 32.8104 496.583 16.3721 506.756 0.00386047L506.755 0.00986099Z" class="cityFill" fill-opacity="0.72" />
    </IconBase>
  </header>
</template>

<script lang="ts">
import { Component, Vue } from 'nuxt-property-decorator'
import { mdiExitRun } from '@mdi/js'
import UserStore from '@/store/user'
import IconBase from '@/components/UI/icons/IconBase.vue'
import AppSwitch from '~/components/UI/controls/Switch.vue'
import Burger from '@/components/UI/Burger.vue'
import ClientMenu from '@/components/system/ClientMenu.vue'
import AdminMenu from '@/components/system/AdminMenu.vue'
import Logo from '@/components/UI/Logo.vue'
import { isMobile } from '@/models/constants/device.ts'

@Component({
  components: {
    IconBase, AppSwitch, Burger, ClientMenu, Logo, AdminMenu
  }
})
export default class Header extends Vue {
  store = UserStore.context(this.$store)
  active: boolean = false
  admin: boolean = true
  iconExitRun = mdiExitRun

  get authUser (): boolean {
    return this.store.getters.getToken
  }

  public mounted (): void {
    this.activeBurger()
    window.addEventListener('resize', this.activeBurger)
  }

  public unmounted (): void {
    this.activeBurger()
    window.addEventListener('resize', this.activeBurger)
  }

  public activeBurger (): void {
    if (((!isMobile.any()) && this.active && document.body.offsetWidth > 768) || (this.active && document.body.offsetWidth > 768)) {
      this.active = false
    }
    this.$emit('headerWidth', this.$el.clientWidth)
  }

  public choiceLink (): void {
    if (this.active === true) { this.active = false }
  }

  public logoutUser (): void {
    this.store.actions.logoutUser()
      .then(() => {
        this.$router.push('/')
      })
  }
}

</script>

<style lang="scss">
.header {
  transition: all .3s ease-in-out .6s;
  height: 100%;
  width: 4.375rem;
  position: fixed;
  top: 0; left: 0;
  z-index: 1;
  overflow: hidden;
  background: transparent;
  @include mq(md) {
    width: 18rem;
  }
  @include mq(xl) {
    width: 28.75rem;
  }

  &:after {
    content: '';
    position: absolute;
    width: 2px;
    height: 60%;
    background: var(--bg-background-ternary);
    right: 0;
    top: 20%;
    bottom: 20%;
  }
  &.active {
    width: 100%;
    transition: all .6s ease-out 0s;
    background: var(--bg-background-primary)
  }
}
.header-container {
  overflow-y: auto;
  width: 100%;
  height: 100%;
  min-height: 100vh;
  position: absolute;
  transition: all .3s ease-in .3s;
  right: -150%; top: 0;
  opacity: 0;
  padding: 3rem 2rem;
  display: flex;
  flex-direction: column;
  justify-content: space-between;
  @include mq(md) {
    right: 0;
    opacity: 1;
  }
  &.active {
    right: 0;
    opacity: 1;
    transition-timing-function: cubic-bezier(0, 0, 0.2, 1);
  }
}

.iconCity {
  display: block;
  position: absolute;
  bottom: -30%;
  left: 0;
  z-index: -1;
  @include mq(md, min) {
    bottom: -7.74%;
  }

}
.cityFill {
  fill: var(--city-background-primary)
}

.controls {
  display: flex;
  justify-content: space-between;
  align-items: center;
}
</style>
